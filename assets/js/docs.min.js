$(function () {
	
	document.title = ($('[data-header]:first').size() > 0) ? (($.trim($('[data-header]:first').text()) == '') ? document.title : $.trim($('[data-header]:first').text())) : document.title;
	
	bootbox.setLocale('es');
	
	$('[title]').tooltip({
		container: 'body',
		trigger: 'hover'
	});

	$('[data-toggle="lightbox"]').lightbox({
		size: 'modal-lg'
	});
	
	$('[data-toggle="filestyle"]').filestyle({
		buttonText: 'Abrir',
		buttonName: 'btn-default',
		iconName: 'glyphicon glyphicon-paperclip',
		placeholder: 'Seleccionar'
	});
	
	var $seleccionar = $('[data-comando-seleccionar]'), $elegir = $('[data-comando-elegir]'), $this, todos, elegidos, parametros;
	
	$seleccionar.on('change', function () {
		$elegir.prop('checked', $(this).prop('checked')).trigger('change');
	});
	
	$elegir.on('change', function () {
		$this = $(this);
		todos = $elegir.size();
		elegidos = 0;
		parametros = [];
		$elegir.filter(':checked').each(function () {
			parametros.push($(this).attr('data-comando-elegir'));
			elegidos = elegidos + 1;
		});
		if ($this.prop('checked')) {
			$this.closest('tr').addClass('info');
		} else {
			$this.closest('tr').removeClass('info');
		}
		switch (elegidos) {
			case 0:
				$seleccionar.prop({
					checked: false,
					indeterminate: false
				});
				break;
			case todos:
				$seleccionar.prop({
					checked: true,
					indeterminate: false
				});
				break;
			default:
				$seleccionar.prop({
					checked: false,
					indeterminate: true
				});
				break;
		}
		parametros = parametros.join('-');
		parametros = (parametros != '') ? parametros : 'true';
		$seleccionar.attr('data-comando-seleccionar', parametros);
	});
	
	$(window).bind('keydown', function (e) {
		if ($('.modal:visible').size() < 1) {
			if (e.altKey || e.metaKey) {
				e.preventDefault();
				switch (String.fromCharCode(e.which).toLowerCase()) {
					case 'a':
						$('[data-comando-seleccionar]:first').trigger('click');
						break;
					case 'c':
						$('[data-comando-crear]:first').trigger('click');
						break;
					case 'u':
						$('[data-comando-modificar]:first').trigger('click');
						break;
					case 'd':
						$('[data-comando-eliminar]:first').trigger('click');
						break;
					case 'h':
						$('[data-comando-ayudar]:first').trigger('click');
						break;
				}
			}
		}
	});
	
	/*if (annyang) {
		var commands = {
			'principal': function () {
				window.location = '?/principal/escritorio';
			},
			'cerrar': function () {
				window.location = '?/sitio/salir';
			},
			'listar :modulo': function (modulo) {
				modulo = clear(modulo);
				window.location = '?/' + modulo + '/listar';
			},
			'crear :modulo': function (modulo) {
				modulo = clear(modulo);
				window.location = '?/' + modulo + '/listar';
			},
			'inscribir cliente': function (modulo) {
				modulo = clear(modulo);
				window.location = '?/inscripciones/inscribir';
			}
		};
		annyang.init(commands, true);
		annyang.addCommands(commands);
		annyang.setLanguage('es-BO');
		annyang.start();
	}*/
	
});